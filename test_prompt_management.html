<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tools Management Test</title>
    <link rel="stylesheet" href="assets/css/popup.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI ChatHub - Tools Management Test</h1>
        </div>
        
        <div class="tool-categories">
            <div class="tool-header">
                <h2>AIå·¥å…·å¯¼èˆª</h2>
                <div class="tool-controls">
                    <button id="manage-menu-btn" class="btn manage-menu-btn" title="ç®¡ç†å·¥å…·">âš™ï¸</button>
                    <div id="manage-dropdown" class="dropdown-menu hidden">
                        <button id="add-tool-btn" class="dropdown-item">
                            <span class="icon">â•</span>
                            <span>æ·»åŠ å·¥å…·</span>
                        </button>
                        <button id="manage-category-btn" class="dropdown-item">
                            <span class="icon">ğŸ“</span>
                            <span>ç®¡ç†åˆ†ç±»</span>
                        </button>
                        <button id="toggle-edit-mode-btn" class="dropdown-item">
                            <span class="icon">âœï¸</span>
                            <span>ç¼–è¾‘æ¨¡å¼</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="category">
                <div class="category-header">
                    <h3>é€šç”¨ç±»</h3>
                    <button class="category-delete-btn hidden" data-category="é€šç”¨ç±»">Ã—</button>
                </div>
                <div class="subcategories">
                    <div class="subcategory">
                        <div class="subcategory-header">
                            <h4>å›½å†…å¯ç”¨</h4>
                            <button class="subcategory-delete-btn hidden" data-category="é€šç”¨ç±»" data-subcategory="å›½å†…å¯ç”¨">Ã—</button>
                        </div>
                        <ul class="tool-list">
                            <li class="tool-item" draggable="true">
                                <div class="drag-handle hidden">â˜°</div>
                                <div class="tool-info">
                                    <a href="https://chat.deepseek.com" target="_blank">DeepSeek</a>
                                    <span class="status-indicator" style="background-color: green"></span>
                                </div>
                                <div class="tool-actions">
                                    <button class="tool-delete-btn hidden">Ã—</button>
                                </div>
                            </li>
                            <li class="tool-item" draggable="true">
                                <div class="drag-handle hidden">â˜°</div>
                                <div class="tool-info">
                                    <a href="https://kimi.moonshot.cn" target="_blank">Kimi</a>
                                    <span class="status-indicator" style="background-color: green"></span>
                                </div>
                                <div class="tool-actions">
                                    <button class="tool-delete-btn hidden">Ã—</button>
                                </div>
                            </li>
                            <li class="tool-item" draggable="true">
                                <div class="drag-handle hidden">â˜°</div>
                                <div class="tool-info">
                                    <a href="https://yiyan.baidu.com" target="_blank">ç™¾åº¦æ–‡å¿ƒä¸€è¨€</a>
                                    <span class="status-indicator" style="background-color: green"></span>
                                </div>
                                <div class="tool-actions">
                                    <button class="tool-delete-btn hidden">Ã—</button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="category">
                <div class="category-header">
                    <h3>ç¿»è¯‘</h3>
                    <button class="category-delete-btn hidden" data-category="ç¿»è¯‘">Ã—</button>
                </div>
                <div class="subcategories">
                    <div class="subcategory">
                        <div class="subcategory-header">
                            <h4>å›½å†…å¯ç”¨</h4>
                            <button class="subcategory-delete-btn hidden" data-category="ç¿»è¯‘" data-subcategory="å›½å†…å¯ç”¨">Ã—</button>
                        </div>
                        <ul class="tool-list">
                            <li class="tool-item" draggable="true">
                                <div class="drag-handle hidden">â˜°</div>
                                <div class="tool-info">
                                    <a href="https://fanyi.baidu.com" target="_blank">ç™¾åº¦ç¿»è¯‘</a>
                                    <span class="status-indicator" style="background-color: green"></span>
                                </div>
                                <div class="tool-actions">
                                    <button class="tool-delete-btn hidden">Ã—</button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Tool Modal -->
    <div id="add-tool-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ AIå·¥å…·</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å·¥å…·åç§°:</label>
                    <input type="text" id="tool-name" placeholder="è¯·è¾“å…¥å·¥å…·åç§°">
                </div>
                <div class="form-group">
                    <label>å·¥å…·é“¾æ¥:</label>
                    <input type="url" id="tool-url" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label>é€‰æ‹©åˆ†ç±»:</label>
                    <select id="tool-category">
                        <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                        <option value="é€šç”¨ç±»">é€šç”¨ç±»</option>
                        <option value="ç¿»è¯‘">ç¿»è¯‘</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é€‰æ‹©å­åˆ†ç±»:</label>
                    <select id="tool-subcategory">
                        <option value="">è¯·é€‰æ‹©å­åˆ†ç±»</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-tool-btn" class="btn primary-btn">ä¿å­˜</button>
                <button class="btn cancel-btn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div id="category-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åˆ†ç±»ç®¡ç†</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="category-management">
                    <div class="add-category-section">
                        <h4>æ·»åŠ æ–°åˆ†ç±»</h4>
                        <div class="form-group">
                            <input type="text" id="new-category" placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°">
                            <button id="add-category-btn" class="btn">æ·»åŠ </button>
                        </div>
                        <div class="form-group">
                            <select id="parent-category">
                                <option value="">é€‰æ‹©çˆ¶åˆ†ç±»(å¯é€‰)</option>
                            </select>
                            <input type="text" id="new-subcategory" placeholder="å­åˆ†ç±»åç§°">
                            <button id="add-subcategory-btn" class="btn">æ·»åŠ å­åˆ†ç±»</button>
                        </div>
                    </div>
                    <div class="existing-categories">
                        <h4>ç°æœ‰åˆ†ç±»</h4>
                        <div id="category-list">
                            <div class="category-item">
                                <div class="category-name">
                                    é€šç”¨ç±»
                                    <button class="btn delete-category-btn">åˆ é™¤</button>
                                </div>
                                <div class="subcategory-list">
                                    <div class="subcategory-item">
                                        <span>â€¢ å›½å†…å¯ç”¨</span>
                                        <button class="btn delete-subcategory-btn">åˆ é™¤</button>
                                    </div>
                                    <div class="subcategory-item">
                                        <span>â€¢ å›½é™…å·¥å…·</span>
                                        <button class="btn delete-subcategory-btn">åˆ é™¤</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn cancel-btn">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // ç®¡ç†èœå•åŠŸèƒ½
        document.getElementById('manage-menu-btn').addEventListener('click', function() {
            const dropdown = document.getElementById('manage-dropdown');
            dropdown.classList.toggle('hidden');
        });
        
        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.tool-controls')) {
                document.getElementById('manage-dropdown').classList.add('hidden');
            }
        });
        
        // ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
        let isEditMode = false;
        document.getElementById('toggle-edit-mode-btn').addEventListener('click', function() {
            const toolDeleteBtns = document.querySelectorAll('.tool-delete-btn');
            const dragHandles = document.querySelectorAll('.drag-handle');
            const categoryDeleteBtns = document.querySelectorAll('.category-delete-btn');
            const subcategoryDeleteBtns = document.querySelectorAll('.subcategory-delete-btn');
            const toolItems = document.querySelectorAll('.tool-item');
            
            isEditMode = !isEditMode;
            
            [...toolDeleteBtns, ...dragHandles, ...categoryDeleteBtns, ...subcategoryDeleteBtns].forEach(btn => {
                if (isEditMode) {
                    btn.classList.remove('hidden');
                } else {
                    btn.classList.add('hidden');
                }
            });
            
            // åˆ‡æ¢æ‹–æ‹½åŠŸèƒ½
            toolItems.forEach(item => {
                if (isEditMode) {
                    item.draggable = true;
                    item.classList.add('draggable-mode');
                } else {
                    item.draggable = false;
                    item.classList.remove('draggable-mode');
                }
            });
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const icon = this.querySelector('.icon');
            const text = this.querySelector('span:last-child');
            
            if (isEditMode) {
                icon.textContent = 'âœ“';
                text.textContent = 'é€€å‡ºç¼–è¾‘';
                this.classList.add('active');
            } else {
                icon.textContent = 'âœï¸';
                text.textContent = 'ç¼–è¾‘æ¨¡å¼';
                this.classList.remove('active');
            }
            
            // éšè—ä¸‹æ‹‰èœå•
            document.getElementById('manage-dropdown').classList.add('hidden');
        });
        
        // æ·»åŠ ç®€å•çš„æ‹–æ‹½æ¼”ç¤ºåŠŸèƒ½
        document.querySelectorAll('.tool-item').forEach(item => {
            item.addEventListener('dragstart', function(e) {
                this.classList.add('dragging');
                e.dataTransfer.setData('text/plain', '');
            });
            
            item.addEventListener('dragend', function() {
                this.classList.remove('dragging');
                document.querySelectorAll('.tool-list').forEach(list => {
                    list.classList.remove('drag-over');
                });
            });
        });
        
        document.querySelectorAll('.tool-list').forEach(list => {
            list.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            list.addEventListener('dragleave', function(e) {
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('drag-over');
                }
            });
            
            list.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                console.log('å·¥å…·å·²æ‹–æ”¾åˆ°:', this.closest('.subcategory').querySelector('h4').textContent);
            });
        });
        
        // æ¨¡æ€æ¡†äº‹ä»¶
        document.getElementById('add-tool-btn').addEventListener('click', () => {
            document.getElementById('manage-dropdown').classList.add('hidden');
            document.getElementById('add-tool-modal').classList.remove('hidden');
        });
        
        document.getElementById('manage-category-btn').addEventListener('click', () => {
            document.getElementById('manage-dropdown').classList.add('hidden');
            document.getElementById('category-modal').classList.remove('hidden');
        });
        
        // å…³é—­æ¨¡æ€æ¡†
        document.querySelectorAll('.close-btn, .cancel-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.add('hidden');
                });
            });
        });
        
        // åˆ†ç±»é€‰æ‹©å˜åŒ–
        document.getElementById('tool-category').addEventListener('change', function() {
            const subcategorySelect = document.getElementById('tool-subcategory');
            subcategorySelect.innerHTML = '<option value="">è¯·é€‰æ‹©å­åˆ†ç±»</option>';
            
            if (this.value === 'é€šç”¨ç±»') {
                subcategorySelect.innerHTML += '<option value="å›½å†…å¯ç”¨">å›½å†…å¯ç”¨</option><option value="å›½é™…å·¥å…·">å›½é™…å·¥å…·</option>';
            } else if (this.value === 'ç¿»è¯‘') {
                subcategorySelect.innerHTML += '<option value="å›½å†…å¯ç”¨">å›½å†…å¯ç”¨</option><option value="å›½é™…å·¥å…·">å›½é™…å·¥å…·</option>';
            }
        });
        
        // æ¼”ç¤ºä¿å­˜åŠŸèƒ½
        document.getElementById('save-tool-btn').addEventListener('click', () => {
            const name = document.getElementById('tool-name').value;
            const url = document.getElementById('tool-url').value;
            const category = document.getElementById('tool-category').value;
            const subcategory = document.getElementById('tool-subcategory').value;
            
            if (name && url && category && subcategory) {
                alert(`å·¥å…·å·²æ·»åŠ :\nåç§°: ${name}\nURL: ${url}\nåˆ†ç±»: ${category} - ${subcategory}`);
                document.getElementById('add-tool-modal').classList.add('hidden');
                // æ¸…ç©ºè¡¨å•
                document.getElementById('tool-name').value = '';
                document.getElementById('tool-url').value = '';
                document.getElementById('tool-category').value = '';
                document.getElementById('tool-subcategory').value = '';
            } else {
                alert('è¯·å¡«å†™å®Œæ•´çš„å·¥å…·ä¿¡æ¯');
            }
        });
    </script>
</body>
</html>